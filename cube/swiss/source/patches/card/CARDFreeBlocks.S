#include "../asm.h"

#	CARDFreeBlocks - "Returns the number of free bytes and the number of free directory entries in the memory card."
#	r3	chan
#	r4	byteNotUsed
#	r5	filesNotUsed

#	return slot 0 CARD_RESULT_READY
#	return slot 1 CARD_RESULT_NOCARD

.globl CARDFreeBlocks
CARDFreeBlocks:
	cmpwi	%r3, 0
	beq		CARDPresent

	li      %r3, -3
	blr
CARDPresent:

	lis		%r3, 7			# 483,328 bytes (memcard 59)
	ori		%r3, %r3, 0x6000
	stw		%r3, 0(%r4)

	li		%r3, 0xFF
	stw		%r3, 0(%r5)			# 255 files

	li		%r3, 0

end:
	blr

	.globl CARDFreeBlocks_length
	CARDFreeBlocks_length:
	.long (CARDFreeBlocks_length - CARDFreeBlocks)